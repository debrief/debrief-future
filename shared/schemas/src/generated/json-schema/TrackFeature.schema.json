{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "$id": "https://debrief.info/schemas/TrackFeature",
  "additionalProperties": false,
  "description": "GeoJSON Feature representing a vessel track",
  "properties": {
    "bbox": {
      "description": "Bounding box [minLon, minLat, maxLon, maxLat]",
      "items": {
        "type": "number"
      },
      "maxItems": 4,
      "minItems": 4,
      "type": [
        "array",
        "null"
      ]
    },
    "geometry": {
      "$ref": "#/$defs/GeoJSONLineString",
      "description": "Track path as GeoJSON LineString"
    },
    "id": {
      "description": "Unique identifier (UUID recommended)",
      "type": "string"
    },
    "properties": {
      "$ref": "#/$defs/TrackProperties",
      "description": "Track metadata"
    },
    "type": {
      "const": "Feature",
      "description": "GeoJSON type discriminator",
      "type": "string"
    }
  },
  "required": [
    "type",
    "id",
    "geometry",
    "properties"
  ],
  "title": "TrackFeature",
  "type": "object",
  "$defs": {
    "GeoJSONLineString": {
      "additionalProperties": false,
      "description": "GeoJSON LineString geometry",
      "properties": {
        "coordinates": {
          "description": "Array of [longitude, latitude] pairs",
          "items": {
            "type": "number"
          },
          "type": "array"
        },
        "type": {
          "const": "LineString",
          "description": "Geometry type discriminator",
          "type": "string"
        }
      },
      "required": [
        "type",
        "coordinates"
      ],
      "title": "GeoJSONLineString",
      "type": "object"
    },
    "GeoJSONPoint": {
      "additionalProperties": false,
      "description": "GeoJSON Point geometry",
      "properties": {
        "coordinates": {
          "description": "[longitude, latitude] in degrees",
          "items": {
            "type": "number"
          },
          "maxItems": 2,
          "minItems": 2,
          "type": "array"
        },
        "type": {
          "const": "Point",
          "description": "Geometry type discriminator",
          "type": "string"
        }
      },
      "required": [
        "type",
        "coordinates"
      ],
      "title": "GeoJSONPoint",
      "type": "object"
    },
    "GeoJSONPolygon": {
      "additionalProperties": false,
      "description": "GeoJSON Polygon geometry",
      "properties": {
        "coordinates": {
          "description": "Array of linear rings (arrays of [lon, lat] pairs)",
          "items": {
            "type": "number"
          },
          "type": "array"
        },
        "type": {
          "const": "Polygon",
          "description": "Geometry type discriminator",
          "type": "string"
        }
      },
      "required": [
        "type",
        "coordinates"
      ],
      "title": "GeoJSONPolygon",
      "type": "object"
    },
    "LocationTypeEnum": {
      "description": "Type of reference location",
      "enum": [
        "WAYPOINT",
        "EXERCISE_AREA",
        "DANGER_AREA",
        "ANCHORAGE",
        "PORT",
        "REFERENCE"
      ],
      "title": "LocationTypeEnum",
      "type": "string"
    },
    "PlotMetadata": {
      "additionalProperties": false,
      "description": "STAC Item properties for a Debrief plot",
      "if": {
        "not": {
          "required": [
            "datetime"
          ]
        },
        "properties": {
          "datetime": {}
        }
      },
      "properties": {
        "classification": {
          "description": "Security classification",
          "type": [
            "string",
            "null"
          ]
        },
        "created": {
          "description": "Plot creation timestamp",
          "format": "date-time",
          "type": "string"
        },
        "datetime": {
          "description": "Single datetime (if not range)",
          "format": "date-time",
          "type": [
            "string",
            "null"
          ]
        },
        "description": {
          "description": "Plot description",
          "type": [
            "string",
            "null"
          ]
        },
        "end_datetime": {
          "description": "End of temporal extent",
          "format": "date-time",
          "type": [
            "string",
            "null"
          ]
        },
        "exercise_name": {
          "description": "Exercise/operation name",
          "type": [
            "string",
            "null"
          ]
        },
        "id": {
          "description": "Unique plot identifier",
          "type": "string"
        },
        "platform_ids": {
          "description": "Platforms included in plot",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "source_files": {
          "description": "List of source files",
          "items": {
            "$ref": "#/$defs/SourceFile"
          },
          "minItems": 1,
          "type": "array"
        },
        "start_datetime": {
          "description": "Start of temporal extent",
          "format": "date-time",
          "type": [
            "string",
            "null"
          ]
        },
        "title": {
          "description": "Human-readable plot title",
          "type": "string"
        },
        "updated": {
          "description": "Last update timestamp",
          "format": "date-time",
          "type": "string"
        }
      },
      "required": [
        "id",
        "title",
        "created",
        "updated",
        "source_files"
      ],
      "then": {
        "properties": {
          "end_datetime": {},
          "start_datetime": {}
        },
        "required": [
          "start_datetime",
          "end_datetime"
        ]
      },
      "title": "PlotMetadata",
      "type": "object"
    },
    "ReferenceLocation": {
      "additionalProperties": false,
      "description": "GeoJSON Feature for fixed reference points",
      "properties": {
        "geometry": {
          "$ref": "#/$defs/GeoJSONPoint",
          "description": "Location (Point) or area (Polygon)"
        },
        "id": {
          "description": "Unique identifier",
          "type": "string"
        },
        "properties": {
          "$ref": "#/$defs/ReferenceLocationProperties",
          "description": "Reference metadata"
        },
        "type": {
          "const": "Feature",
          "description": "GeoJSON type discriminator",
          "type": "string"
        }
      },
      "required": [
        "type",
        "id",
        "geometry",
        "properties"
      ],
      "title": "ReferenceLocation",
      "type": "object"
    },
    "ReferenceLocationProperties": {
      "additionalProperties": false,
      "description": "Properties for a ReferenceLocation",
      "properties": {
        "color": {
          "description": "Display color (CSS color string)",
          "pattern": "^(#[0-9A-Fa-f]{3,8}|[a-zA-Z]+|rgb\\(.+\\)|rgba\\(.+\\)|hsl\\(.+\\)|hsla\\(.+\\))$",
          "type": [
            "string",
            "null"
          ]
        },
        "description": {
          "description": "Additional description",
          "type": [
            "string",
            "null"
          ]
        },
        "location_type": {
          "$ref": "#/$defs/LocationTypeEnum",
          "description": "Type of reference"
        },
        "name": {
          "description": "Reference location name",
          "type": "string"
        },
        "symbol": {
          "description": "Map symbol identifier",
          "type": [
            "string",
            "null"
          ]
        },
        "valid_from": {
          "description": "Start of validity period",
          "format": "date-time",
          "type": [
            "string",
            "null"
          ]
        },
        "valid_until": {
          "description": "End of validity period",
          "format": "date-time",
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "name",
        "location_type"
      ],
      "title": "ReferenceLocationProperties",
      "type": "object"
    },
    "SelectionContextEnum": {
      "description": "Type of selection context required by a tool",
      "enum": [
        "SINGLE_TRACK",
        "MULTIPLE_TRACKS",
        "TIME_PERIOD",
        "TRACK_SEGMENT",
        "SENSOR_CONTACT",
        "FEATURE_SET"
      ],
      "title": "SelectionContextEnum",
      "type": "string"
    },
    "SensorContact": {
      "additionalProperties": false,
      "description": "GeoJSON Feature representing a sensor detection",
      "properties": {
        "geometry": {
          "$ref": "#/$defs/GeoJSONPoint",
          "description": "Contact position as GeoJSON Point"
        },
        "id": {
          "description": "Unique identifier (UUID recommended)",
          "type": "string"
        },
        "properties": {
          "$ref": "#/$defs/SensorContactProperties",
          "description": "Contact metadata"
        },
        "type": {
          "const": "Feature",
          "description": "GeoJSON type discriminator",
          "type": "string"
        }
      },
      "required": [
        "type",
        "id",
        "geometry",
        "properties"
      ],
      "title": "SensorContact",
      "type": "object"
    },
    "SensorContactProperties": {
      "additionalProperties": false,
      "description": "Properties for a SensorContact",
      "properties": {
        "bearing": {
          "description": "Bearing in degrees (0-360)",
          "maximum": 360,
          "minimum": 0,
          "type": [
            "number",
            "null"
          ]
        },
        "bearing_error": {
          "description": "Bearing error in degrees",
          "minimum": 0,
          "type": [
            "number",
            "null"
          ]
        },
        "color": {
          "description": "Display color (CSS color string)",
          "pattern": "^(#[0-9A-Fa-f]{3,8}|[a-zA-Z]+|rgb\\(.+\\)|rgba\\(.+\\)|hsl\\(.+\\)|hsla\\(.+\\))$",
          "type": [
            "string",
            "null"
          ]
        },
        "frequency": {
          "description": "Frequency in Hz (for acoustic)",
          "minimum": 0,
          "type": [
            "number",
            "null"
          ]
        },
        "label": {
          "description": "User-assigned label",
          "type": [
            "string",
            "null"
          ]
        },
        "parent_track_id": {
          "description": "ID of parent TrackFeature",
          "type": "string"
        },
        "range": {
          "description": "Range in nautical miles",
          "minimum": 0,
          "type": [
            "number",
            "null"
          ]
        },
        "range_error": {
          "description": "Range error in nautical miles",
          "minimum": 0,
          "type": [
            "number",
            "null"
          ]
        },
        "sensor_type": {
          "$ref": "#/$defs/SensorTypeEnum",
          "description": "Type of sensor"
        },
        "time": {
          "description": "Detection timestamp (ISO8601)",
          "format": "date-time",
          "type": "string"
        }
      },
      "required": [
        "parent_track_id",
        "sensor_type",
        "time"
      ],
      "title": "SensorContactProperties",
      "type": "object"
    },
    "SensorTypeEnum": {
      "description": "Type of sensor that produced a contact",
      "enum": [
        "SONAR_ACTIVE",
        "SONAR_PASSIVE",
        "RADAR",
        "ESM",
        "VISUAL",
        "AIS",
        "OTHER"
      ],
      "title": "SensorTypeEnum",
      "type": "string"
    },
    "SourceFile": {
      "additionalProperties": false,
      "description": "Metadata about a source file loaded into a plot",
      "properties": {
        "asset_href": {
          "description": "Path to asset in STAC catalog",
          "type": "string"
        },
        "filename": {
          "description": "Original filename",
          "type": "string"
        },
        "format": {
          "description": "File format (e.g., \"REP\", \"CSV\")",
          "type": "string"
        },
        "loaded_at": {
          "description": "When file was loaded",
          "format": "date-time",
          "type": "string"
        },
        "sha256": {
          "description": "SHA256 hash of file contents",
          "pattern": "^[a-f0-9]{64}$",
          "type": "string"
        }
      },
      "required": [
        "filename",
        "format",
        "loaded_at",
        "sha256",
        "asset_href"
      ],
      "title": "SourceFile",
      "type": "object"
    },
    "TimestampedPosition": {
      "additionalProperties": false,
      "description": "A position with timestamp and optional kinematic data",
      "properties": {
        "coordinates": {
          "description": "[longitude, latitude] in degrees",
          "items": {
            "type": "number"
          },
          "maxItems": 2,
          "minItems": 2,
          "type": "array"
        },
        "course": {
          "description": "Course in degrees (0-360)",
          "maximum": 360,
          "minimum": 0,
          "type": [
            "number",
            "null"
          ]
        },
        "depth": {
          "description": "Depth in meters (negative = below surface)",
          "type": [
            "number",
            "null"
          ]
        },
        "speed": {
          "description": "Speed in knots",
          "minimum": 0,
          "type": [
            "number",
            "null"
          ]
        },
        "time": {
          "description": "Position timestamp (ISO8601)",
          "format": "date-time",
          "type": "string"
        }
      },
      "required": [
        "time",
        "coordinates"
      ],
      "title": "TimestampedPosition",
      "type": "object"
    },
    "ToolCategoryEnum": {
      "description": "Category of analysis tool",
      "enum": [
        "GEOMETRY",
        "KINEMATICS",
        "TACTICAL",
        "EXPORT",
        "TRANSFORM"
      ],
      "title": "ToolCategoryEnum",
      "type": "string"
    },
    "ToolMetadata": {
      "additionalProperties": false,
      "description": "Describes an analysis tool available in the calc service",
      "properties": {
        "category": {
          "$ref": "#/$defs/ToolCategoryEnum",
          "description": "Tool category"
        },
        "description": {
          "description": "Tool description",
          "type": "string"
        },
        "icon": {
          "description": "Icon identifier",
          "type": [
            "string",
            "null"
          ]
        },
        "id": {
          "description": "Unique tool identifier",
          "type": "string"
        },
        "input_schema": {
          "description": "JSON Schema for tool inputs (as JSON string)",
          "type": [
            "string",
            "null"
          ]
        },
        "name": {
          "description": "Human-readable tool name",
          "type": "string"
        },
        "output_schema": {
          "description": "JSON Schema for tool outputs (as JSON string)",
          "type": [
            "string",
            "null"
          ]
        },
        "selection_context": {
          "description": "Required selection types",
          "items": {
            "$ref": "#/$defs/SelectionContextEnum"
          },
          "minItems": 1,
          "type": "array"
        },
        "version": {
          "description": "Tool version (semver recommended)",
          "pattern": "^\\d+\\.\\d+\\.\\d+.*$",
          "type": "string"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "version",
        "category",
        "selection_context"
      ],
      "title": "ToolMetadata",
      "type": "object"
    },
    "TrackFeature": {
      "additionalProperties": false,
      "description": "GeoJSON Feature representing a vessel track",
      "properties": {
        "bbox": {
          "description": "Bounding box [minLon, minLat, maxLon, maxLat]",
          "items": {
            "type": "number"
          },
          "maxItems": 4,
          "minItems": 4,
          "type": [
            "array",
            "null"
          ]
        },
        "geometry": {
          "$ref": "#/$defs/GeoJSONLineString",
          "description": "Track path as GeoJSON LineString"
        },
        "id": {
          "description": "Unique identifier (UUID recommended)",
          "type": "string"
        },
        "properties": {
          "$ref": "#/$defs/TrackProperties",
          "description": "Track metadata"
        },
        "type": {
          "const": "Feature",
          "description": "GeoJSON type discriminator",
          "type": "string"
        }
      },
      "required": [
        "type",
        "id",
        "geometry",
        "properties"
      ],
      "title": "TrackFeature",
      "type": "object"
    },
    "TrackProperties": {
      "additionalProperties": false,
      "description": "Properties for a TrackFeature",
      "properties": {
        "color": {
          "description": "Display color (CSS color string)",
          "pattern": "^(#[0-9A-Fa-f]{3,8}|[a-zA-Z]+|rgb\\(.+\\)|rgba\\(.+\\)|hsl\\(.+\\)|hsla\\(.+\\))$",
          "type": [
            "string",
            "null"
          ]
        },
        "end_time": {
          "description": "Track end time (ISO8601)",
          "format": "date-time",
          "type": "string"
        },
        "platform_id": {
          "description": "Platform/vessel identifier",
          "type": "string"
        },
        "platform_name": {
          "description": "Human-readable platform name",
          "type": [
            "string",
            "null"
          ]
        },
        "positions": {
          "description": "Array of timestamped positions",
          "items": {
            "$ref": "#/$defs/TimestampedPosition"
          },
          "minItems": 2,
          "type": "array"
        },
        "source_file": {
          "description": "Original source file path",
          "type": [
            "string",
            "null"
          ]
        },
        "start_time": {
          "description": "Track start time (ISO8601)",
          "format": "date-time",
          "type": "string"
        },
        "track_type": {
          "$ref": "#/$defs/TrackTypeEnum",
          "description": "Type of track"
        }
      },
      "required": [
        "platform_id",
        "track_type",
        "start_time",
        "end_time",
        "positions"
      ],
      "title": "TrackProperties",
      "type": "object"
    },
    "TrackTypeEnum": {
      "description": "Type of track feature",
      "enum": [
        "OWNSHIP",
        "CONTACT",
        "REFERENCE",
        "SOLUTION"
      ],
      "title": "TrackTypeEnum",
      "type": "string"
    }
  }
}